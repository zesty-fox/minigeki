# ONGEKI Mini Controller

这是用于 SEGA 的街机音游 ONGEKI（音击）设计的（不）迷你控制器。

这个仓库基于 [Lee65535/Minigeki](https://github.com/Lee65535/Minigeki) 和 [HanasakiMana/Minigeki](https://github.com/HanasakiMana/Minigeki) 进行魔改。

成品如图：

![完成品照片](./img/top.jpg)
![侧面照片](./img/side.jpg)

## 结构

整体结构参考了 Lee 的五层板设计和 Hanasaki 的扩大尺寸的 PCB 板设计。

- 整体大小约为 250mm $\times$ 200mm $\times$ 13.3mm；
- 最底层是一个带有脚垫的底板，厚度 1.6mm；
- 下夹层是一个 5mm 厚的亚克力板；
- 中间层为 PCB 板（由 Hanasaki 设计），厚度 1.6mm；
- 上夹层是一个 3.5mm 厚的亚克力板；
- 最顶层是一个 1.6mm 厚的面板，兼顾定位板功能。
- 整体通过 6 组 M3*18 杯头螺丝和盖型螺母固定，其中杯头螺丝自下而上穿过各层，每个杯头外套一个硅胶平头套用作脚垫。

为了节省时间，我的上下夹层平面设计相同（只有厚度不同）。

### 如果想要组装

你需要的元件有：

- 1 个 SparkFun Pro Micro 单片机（或仿品）
- 10 颗键轴及键帽，推荐其中 2 颗键帽使用 1.75U 或 2U 大小用于侧键
- 10 个热插拔轴座
- 10 颗 WS2812B LED 灯珠，当然由于 LED 十分难焊，不需要 LED 也可以不装
- 1 个 75mm、类型 B10K 的双联直滑电位器（也就是调音台上的推子）。
  - 类型的含义如下：第 1 位代表变化类型，A 为对数变化，B 为线性变化；后面代表最大电阻，10K 代表 10 千欧姆，50K 代表 50 千欧姆；
  - 我使用了 ALPS RS60112A6A0C 来替换原方案的 NOBLE XJV60GPV15C-15A20K，因为后者是对数变化而不适用；
  - 上面可以再加装一个 3D 打印的仿官机手柄（由原作者设计）。

对于总体结构：

- PCB 板直接去找厂家下单；
- 对于上下夹层，可以拿平面图找商家定制即可。我采用了黑色亚克力，当然你可以尝试 POM 或者 EVA 棉等更好的材料；
- 对于顶层和底层，铝合金或者 FR4 材质都是不错的选择。我这里直接设计了空的 PCB 板（FR4）充当顶层和底层。
- 可以用各类在线模型查看器来查看仓库中模型的实际效果。

此外还有连接件：

- 6 颗 M3*18 杯头螺丝
- 6 颗 M3 盖型螺母
- 6 个硅胶平头套（用作脚垫），推荐内径 5.1mm、内高 3.5mm（我也不知道为什么商家会有这么完全适配的尺寸）

## 软件

由于未知原因，我刷入原作者的 mu3controller 固件后摇杆和按键触发都相当不稳定，因此我最后选择魔改了原作者 Lee 的键鼠固件。

直接用 PlatformIO 编译并刷入目录下的 firmware-B 固件即可。当然如果你不幸买到了 A 型电位器，可以尝试 firmware-A 固件，其包含了对电位器曲线的调整。

### 关于魔改的原因

原键鼠固件由于采用相对位移方式实现鼠标移动，由于鼠标加速度和累计误差的因素，很容易导致滑杆漂移。

我修改为了将滑杆位置映射为鼠标绝对坐标，解决了这个问题。

## 文件结构

- `Minigeki keyboard firmware-*\`：固件源码
- `img\`：一些图片
- `model\`：模型文件
  - `top_pcb\`：顶层空 PCB 板
  - `above_PCB.step`：上夹层
  - `under_PCB.step`：下夹层
  - `layer.dxf`：夹层平面图
  - `top.step`：顶层面板
  - `bottom.step`：底层面板
  - `mini knob.STL`：滑杆手柄

## License

MIT
